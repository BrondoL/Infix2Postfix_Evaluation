#include <iostream>

using namespace std;

struct stack{
	double StacK[100000];
	char Stack[100000];
	int top;
};

//========================================================================================== Convert

class Conv{
private:
	stack tumpuk;

public:
	void init(){
		tumpuk.top = -1;
	}

	void push(char input){
			tumpuk.top++;
			tumpuk.Stack[tumpuk.top] = input;
	}

	void pop(){
		tumpuk.top--;
	}

	char Top(){
		return tumpuk.Stack[tumpuk.top];
	}

	bool isEmpty(){
		if(tumpuk.top <= -1)
			return true;
		else
			return false;
	}
}; Conv SC;

//========================================================================================== Evaluate

class Eval{
private:
	stack Tumpuk;

public:
	void push(int input){
			Tumpuk.top++;
			Tumpuk.StacK[Tumpuk.top] = input;
	}

	void pop(){
		Tumpuk.top--;
	}

	int Top(){
		return Tumpuk.StacK[Tumpuk.top];
	}
}; Eval SE;

//========================================================================================== Convert

bool isOperand(char input);
bool isOperator(char input);
int getlevel(char input);
bool precedence(char input1, char input2);
string InfixtoPostfix(string input);

//========================================================================================== Evaluate

double Operation(int op1, char c, int op2);
bool Operand(char input);
int Evaluate(string input);
int pow(int number, int exp);

//========================================================================================== Main

int main(){

	string Q;
	cout<<"\thttps://github.com/BrondoL/Infix2Postfix_Evaluation"<<endl;
	cout<<"\t====================================================="<<endl;
	cout<<"\tDAFTAR ANGGOTA KELOMPOK : "<<endl;
	cout<<"\tNama : 1. Aulia Ahmad Nabil\t (1817051074)"<<endl;
	cout<<"\t       2. Arbi Hidayatullah\t (1817051045)"<<endl;
	cout<<"\t       3. Asbiq Al Alawi	\t (1817051026)"<<endl;
	cout<<"\t       4. Pandi Barep Arianza\t (1817051002)"<<endl;
	cout<<"\t====================================================="<<endl<<endl;
	cout<<"\t\t\t    INFIX To POSTFIX"<<endl<<endl;
	cout << "Enter Infix Expression \n";
	cout << (char)62 << (char)62 << " ";
	getline(cin,Q);
	string P = InfixtoPostfix(Q);
	cout << "\nInfix    = " << Q;
	cout << "\nPostfix  = " << P;
	int result = Evaluate(P);
	cout << "\nEvaluate = " << result;

	cin.get();
	return 0;
}

//========================================================================================== Convert

bool isOperand(char input){
	int c = (int)input;
	if(c >= 48 && c <= 57 || c >= 65 && c <= 90 || c >= 97 && c <= 122)
		return true;
	else
		return false;
}

bool isOperator(char input){
	int c = (int)input;
	if(c == 94 || c >= 42 && c <= 43 || c == 45 || c == 47)
		return true;
	else
		return false;
}

int getlevel(char input){
	if(input == '^')
		return 3;
	else if(input == '*' || input == '/')
		return 2;
	else if(input == '+' || input == '-')
		return 1;
	else if(input == '(' || input == ')')
		return 0;
	else
		return -1;
}

bool precedence(char input1, char input2){
	int c1 = getlevel(input1);
	int c2 = getlevel(input2);

	if(c1 <= c2)
		return true;
	else
		return false;
}

string InfixtoPostfix(string input){
	SC.init();
	int i=0;
	string P = "";
	while(input[i] != '\0'){
		if(isOperand(input[i])){
			P += input[i];
		}
		if(input[i] == '('){
			SC.push(input[i]);
		}
		if(input[i] == ')'){
			while(!SC.isEmpty() && SC.Top() != '('){
				P = P + " " + SC.Top(); SC.pop();
			}
			SC.pop();
		}
		if(isOperator(input[i])){
			if(SC.isEmpty() || SC.Top() == '('){
				SC.push(input[i]);
			}else{
				while(!SC.isEmpty() && SC.Top() != '(' && precedence(input[i], SC.Top())){
					P = P + " " + SC.Top(); SC.pop();
				}
				SC.push(input[i]);
			}
		}
		if(isOperator(input[i]))
			P += " "; 
		i++;
	}
	while(!SC.isEmpty()){
		P = P + " " + SC.Top(); SC.pop();
	}
	return P;
}

//========================================================================================== Evaluate

int pow(int number, int exp){
	for(int i=1; i<exp; i++)
		number *= number;
	return number;
}

bool Operand(char input){
	int c = (int)input;
	if(c >= 48 && c <= 57)
		return true;
	else if(c >= 65 && c <= 90 || c >= 97 && c <= 122){
		cout << "\nNot Evaluated" << endl;
		cin.get();
		exit(0);
	}
	else
		return false;
}

double Operation(int op1, char c, int op2){
	if(c == '^')
		return (pow(op1,op2));
	else if(c == '*')
		return (op1 * op2);
	else if(c == '/')
		return (op1 / op2);
	else if(c == '+')
		return (op1 + op2);
	else if(c == '-')
		return (op1 - op2);	
	else return 0;
}

int Evaluate(string input){
	int i = 0;
	while(input[i] != '\0'){
		if(Operand(input[i])){
			int operand = 0;
			while(input[i] != '\0' && Operand(input[i])){
				operand = (operand * 10) + (input[i] - 48);
				i++;
			}
			SE.push(operand);
		}
		if(isOperator(input[i])){
			int A = SE.Top(); SE.pop();
			int B = SE.Top(); SE.pop();
			int result = Operation(B,input[i],A);
			SE.push(result);
		}
		i++;
	}
	return SE.Top();
}
